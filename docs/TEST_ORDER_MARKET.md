# 🧪 订单市场功能测试指南

> 快速测试订单市场的完整功能

---

## ✅ 问题已修复

### 编译错误
```
❌ Module not found: Can't resolve '@/config/contracts'
✅ 已修复为: import { CONTRACTS, PAYMENT_GATEWAY_ABI } from '@/lib/contracts'
```

---

## 🚀 快速测试步骤

### 准备工作

#### 1. 确保前端正在运行
```bash
cd aether-oracle/frontend
npm run dev
```

#### 2. 准备两个钱包
- Account 1（商家）
- Account 2（买家）

---

## 📝 测试流程

### 第 1 步：商家创建多个订单（Account 1）

```bash
# 1. 访问商家后台
http://localhost:3000/dashboard

# 2. 连接 Account 1

# 3. 注册商家（如果未注册）
点击 "Register as Merchant"
输入: "Test Store"

# 4. 创建订单 1
Order ID: ORDER_TEST_001
Amount: 10 USDC
Payment Token: USDC
Settlement Token: USDT

# 5. 创建订单 2
Order ID: ORDER_TEST_002
Amount: 20 USDC
Payment Token: USDC
Settlement Token: USDT

# 6. 创建订单 3
Order ID: ORDER_TEST_003
Amount: 5 USDC
Payment Token: USDC
Settlement Token: USDT
```

---

### 第 2 步：访问订单市场

```bash
# 方式 1：从首页导航
http://localhost:3000
点击导航栏的 "订单市场"

# 方式 2：从用户页面
http://localhost:3000/user
点击 "浏览订单市场" 按钮

# 方式 3：直接访问
http://localhost:3000/orders
```

---

### 第 3 步：测试订单市场功能

#### 3.1 查看统计卡片
```
✅ 应该看到:
- 📋 待支付订单: 3
- ⏰ 即将过期: 0
- 💰 总金额: $35.00
```

#### 3.2 查看订单列表
```
✅ 应该看到 3 个订单:
- ORDER_TEST_001 - $10.00
- ORDER_TEST_002 - $20.00
- ORDER_TEST_003 - $5.00
```

#### 3.3 测试搜索功能
```bash
# 搜索订单号
输入: "ORDER_TEST_001"
✅ 应该只显示 ORDER_TEST_001

# 搜索商家名称
输入: "Test Store"
✅ 应该显示所有 3 个订单

# 清空搜索
删除搜索内容
✅ 应该显示所有订单
```

#### 3.4 测试过滤功能
```bash
# 点击 "即将过期"
✅ 应该显示 0 个订单（因为刚创建）

# 点击 "全部"
✅ 应该显示所有 3 个订单
```

---

### 第 4 步：测试支付流程（Account 2）

```bash
# 1. 切换到 Account 2
MetaMask → 选择 Account 2

# 2. 在订单市场点击 "立即支付"
点击 ORDER_TEST_001 的 "立即支付" 按钮

# 3. 应该跳转到支付页面
http://localhost:3000/pay/ORDER_TEST_001

# 4. 连接钱包（Account 2）
点击 "Connect Wallet"

# 5. 完成支付
Approve → Pay Now

# 6. 支付成功后自动跳转
http://localhost:3000/user
```

---

### 第 5 步：验证结果

#### 5.1 检查订单市场
```bash
# 返回订单市场
http://localhost:3000/orders

✅ 应该看到:
- 📋 待支付订单: 2（减少了 1 个）
- 💰 总金额: $25.00（减少了 $10）
- ORDER_TEST_001 不再显示
```

#### 5.2 检查用户页面
```bash
# 访问用户页面
http://localhost:3000/user

✅ 应该看到:
- 💳 总支付: $10.00
- 💝 总捐赠: $0.005
- 支付历史中有 ORDER_TEST_001
```

#### 5.3 检查支付历史
```bash
# 访问支付历史
http://localhost:3000/user/history

✅ 应该看到:
- 1 笔支付记录
- 订单号: ORDER_TEST_001
- 金额: $10.00
- 状态: ✓ 已完成
```

---

## 🎯 功能检查清单

### 订单市场页面
- [ ] 统计卡片显示正确
- [ ] 订单列表显示所有待支付订单
- [ ] 搜索功能正常工作
- [ ] 过滤功能正常工作
- [ ] 过期时间倒计时正确
- [ ] "立即支付"按钮可点击
- [ ] 已过期订单禁用支付按钮

### 导航入口
- [ ] 首页导航栏有"订单市场"链接
- [ ] 用户页面有"浏览订单市场"按钮
- [ ] 直接访问 /orders 可以打开页面

### 支付流程
- [ ] 点击"立即支付"跳转到支付页面
- [ ] 支付成功后订单从市场消失
- [ ] 统计数据实时更新
- [ ] 用户页面显示支付记录

---

## 🐛 常见问题

### Q1: 订单市场显示 0 个订单
**A**: 
1. 确保商家已创建订单
2. 检查订单状态是否为 PENDING
3. 刷新页面重新加载

### Q2: 搜索功能不工作
**A**: 
1. 检查搜索输入是否正确
2. 确保订单号或商家名称匹配
3. 清空搜索框重试

### Q3: 支付后订单仍显示
**A**: 
1. 刷新订单市场页面
2. 检查交易是否确认
3. 查看浏览器控制台错误

### Q4: 统计数据不准确
**A**: 
1. 刷新页面
2. 检查网络连接
3. 查看浏览器控制台错误

---

## 📊 预期结果

### 初始状态
```
订单市场:
- 待支付订单: 3
- 总金额: $35.00
- 订单列表: ORDER_TEST_001, 002, 003

用户页面:
- 总支付: $0.00
- 总捐赠: $0.00
- 支付历史: 0 笔
```

### 支付 1 笔后
```
订单市场:
- 待支付订单: 2
- 总金额: $25.00
- 订单列表: ORDER_TEST_002, 003

用户页面:
- 总支付: $10.00
- 总捐赠: $0.005
- 支付历史: 1 笔
```

### 支付全部后
```
订单市场:
- 待支付订单: 0
- 总金额: $0.00
- 订单列表: 空

用户页面:
- 总支付: $35.00
- 总捐赠: $0.0175
- 支付历史: 3 笔
```

---

## 🎬 完整测试脚本

```bash
# ========================================
# 第 1 步：商家创建订单（Account 1）
# ========================================
1. http://localhost:3000/dashboard
2. Connect Account 1
3. Register as Merchant: "Test Store"
4. Create Order: ORDER_TEST_001, $10
5. Create Order: ORDER_TEST_002, $20
6. Create Order: ORDER_TEST_003, $5

# ========================================
# 第 2 步：访问订单市场
# ========================================
1. http://localhost:3000/orders
2. 查看统计: 3 个订单, $35.00
3. 查看列表: 3 个订单显示

# ========================================
# 第 3 步：测试搜索和过滤
# ========================================
1. 搜索 "ORDER_TEST_001" → 1 个结果
2. 搜索 "Test Store" → 3 个结果
3. 清空搜索 → 3 个结果
4. 点击 "即将过期" → 0 个结果
5. 点击 "全部" → 3 个结果

# ========================================
# 第 4 步：买家支付（Account 2）
# ========================================
1. 切换到 Account 2
2. 点击 ORDER_TEST_001 的 "立即支付"
3. Connect Account 2
4. Approve → Pay Now
5. 支付成功 → 跳转到 /user

# ========================================
# 第 5 步：验证结果
# ========================================
1. 返回 /orders → 2 个订单, $25.00
2. 访问 /user → $10.00 总支付
3. 访问 /user/history → 1 笔记录

# ========================================
# 第 6 步：继续支付剩余订单
# ========================================
1. 返回 /orders
2. 支付 ORDER_TEST_002 ($20)
3. 支付 ORDER_TEST_003 ($5)
4. 验证 /orders → 0 个订单
5. 验证 /user → $35.00 总支付
```

---

## 🎉 测试完成标准

### ✅ 所有功能正常
- 订单市场显示所有待支付订单
- 搜索和过滤功能正常
- 支付流程完整
- 数据实时更新
- 导航入口可用

### ✅ 用户体验良好
- 页面加载快速
- 交互流畅
- 错误提示清晰
- 响应式设计正常

### ✅ 数据准确
- 统计数据正确
- 订单信息完整
- 支付记录准确
- 状态更新及时

---

## 📚 相关文档

- [订单市场功能说明](./ORDER_MARKET_FEATURE.md)
- [快速开始指南](./QUICK_START.md)
- [支付流程指南](./PAYMENT_FLOW_GUIDE.md)

---

**🚀 现在开始测试吧！**

